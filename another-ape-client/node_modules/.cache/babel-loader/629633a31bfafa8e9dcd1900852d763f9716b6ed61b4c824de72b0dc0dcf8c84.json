{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.SECP256K1Client = void 0;\nconst hmac_1 = require(\"@noble/hashes/hmac\");\nconst sha256_1 = require(\"@noble/hashes/sha256\");\nconst secp = require(\"@noble/secp256k1\");\nconst ecdsaSigFormatter_1 = require(\"../ecdsaSigFormatter\");\nconst errors_1 = require(\"../errors\");\nconst utils_1 = require(\"@noble/hashes/utils\");\n// required to use noble secp https://github.com/paulmillr/noble-secp256k1\nsecp.utils.hmacSha256Sync = (key, ...msgs) => {\n  const h = hmac_1.hmac.create(sha256_1.sha256, key);\n  msgs.forEach(msg => h.update(msg));\n  return h.digest();\n};\nclass SECP256K1Client {\n  static derivePublicKey(privateKey, compressed = true) {\n    if (privateKey.length === 66) {\n      privateKey = privateKey.slice(0, 64);\n    }\n    if (privateKey.length < 64) {\n      // backward compatibly accept too short private keys\n      privateKey = privateKey.padStart(64, '0');\n    }\n    return (0, utils_1.bytesToHex)(secp.getPublicKey(privateKey, compressed));\n  }\n  static signHash(signingInputHash, privateKey, format = 'jose') {\n    // make sure the required parameters are provided\n    if (!signingInputHash || !privateKey) {\n      throw new errors_1.MissingParametersError('a signing input hash and private key are all required');\n    }\n    const derSignature = secp.signSync(signingInputHash, privateKey.slice(0, 64), {\n      der: true,\n      canonical: false\n    });\n    if (format === 'der') return (0, utils_1.bytesToHex)(derSignature);\n    if (format === 'jose') return (0, ecdsaSigFormatter_1.derToJose)(derSignature, 'ES256');\n    throw Error('Invalid signature format');\n  }\n  static loadSignature(joseSignature) {\n    // create and return the DER-formatted signature bytes\n    return (0, ecdsaSigFormatter_1.joseToDer)(joseSignature, 'ES256');\n  }\n  static verifyHash(signingInputHash, derSignatureBytes, publicKey) {\n    // make sure the required parameters are provided\n    if (!signingInputHash || !derSignatureBytes || !publicKey) {\n      throw new errors_1.MissingParametersError('a signing input hash, der signature, and public key are all required');\n    }\n    return secp.verify(derSignatureBytes, signingInputHash, publicKey, {\n      strict: false\n    });\n  }\n}\nexports.SECP256K1Client = SECP256K1Client;\nSECP256K1Client.algorithmName = 'ES256K';","map":{"version":3,"names":["hmac_1","require","sha256_1","secp","ecdsaSigFormatter_1","errors_1","utils_1","utils","hmacSha256Sync","key","msgs","h","hmac","create","sha256","forEach","msg","update","digest","SECP256K1Client","derivePublicKey","privateKey","compressed","length","slice","padStart","bytesToHex","getPublicKey","signHash","signingInputHash","format","MissingParametersError","derSignature","signSync","der","canonical","derToJose","Error","loadSignature","joseSignature","joseToDer","verifyHash","derSignatureBytes","publicKey","verify","strict","exports","algorithmName"],"sources":["cryptoClients/secp256k1.ts"],"sourcesContent":[null],"mappings":";;;;;;AAAA,MAAAA,MAAA,GAAAC,OAAA;AACA,MAAAC,QAAA,GAAAD,OAAA;AACA,MAAAE,IAAA,GAAAF,OAAA;AACA,MAAAG,mBAAA,GAAAH,OAAA;AACA,MAAAI,QAAA,GAAAJ,OAAA;AACA,MAAAK,OAAA,GAAAL,OAAA;AAEA;AACAE,IAAI,CAACI,KAAK,CAACC,cAAc,GAAG,CAACC,GAAe,EAAE,GAAGC,IAAkB,KAAI;EACrE,MAAMC,CAAC,GAAGX,MAAA,CAAAY,IAAI,CAACC,MAAM,CAACX,QAAA,CAAAY,MAAM,EAAEL,GAAG,CAAC;EAClCC,IAAI,CAACK,OAAO,CAACC,GAAG,IAAIL,CAAC,CAACM,MAAM,CAACD,GAAG,CAAC,CAAC;EAClC,OAAOL,CAAC,CAACO,MAAM,EAAE;AACnB,CAAC;AAED,MAAaC,eAAe;EAG1B,OAAOC,eAAeA,CAACC,UAAkB,EAAEC,UAAU,GAAG,IAAI;IAC1D,IAAID,UAAU,CAACE,MAAM,KAAK,EAAE,EAAE;MAC5BF,UAAU,GAAGA,UAAU,CAACG,KAAK,CAAC,CAAC,EAAE,EAAE,CAAC;;IAEtC,IAAIH,UAAU,CAACE,MAAM,GAAG,EAAE,EAAE;MAC1B;MACAF,UAAU,GAAGA,UAAU,CAACI,QAAQ,CAAC,EAAE,EAAE,GAAG,CAAC;;IAE3C,OAAO,IAAAnB,OAAA,CAAAoB,UAAU,EAACvB,IAAI,CAACwB,YAAY,CAACN,UAAU,EAAEC,UAAU,CAAC,CAAC;EAC9D;EAEA,OAAOM,QAAQA,CAACC,gBAAqC,EAAER,UAAkB,EAAES,MAAM,GAAG,MAAM;IACxF;IACA,IAAI,CAACD,gBAAgB,IAAI,CAACR,UAAU,EAAE;MACpC,MAAM,IAAIhB,QAAA,CAAA0B,sBAAsB,CAAC,uDAAuD,CAAC;;IAG3F,MAAMC,YAAY,GAAG7B,IAAI,CAAC8B,QAAQ,CAACJ,gBAAgB,EAAER,UAAU,CAACG,KAAK,CAAC,CAAC,EAAE,EAAE,CAAC,EAAE;MAC5EU,GAAG,EAAE,IAAI;MACTC,SAAS,EAAE;KACZ,CAAC;IAEF,IAAIL,MAAM,KAAK,KAAK,EAAE,OAAO,IAAAxB,OAAA,CAAAoB,UAAU,EAACM,YAAY,CAAC;IACrD,IAAIF,MAAM,KAAK,MAAM,EAAE,OAAO,IAAA1B,mBAAA,CAAAgC,SAAS,EAACJ,YAAY,EAAE,OAAO,CAAC;IAE9D,MAAMK,KAAK,CAAC,0BAA0B,CAAC;EACzC;EAEA,OAAOC,aAAaA,CAACC,aAAkC;IACrD;IACA,OAAO,IAAAnC,mBAAA,CAAAoC,SAAS,EAACD,aAAa,EAAE,OAAO,CAAC;EAC1C;EAEA,OAAOE,UAAUA,CACfZ,gBAA4B,EAC5Ba,iBAAsC,EACtCC,SAA8B;IAE9B;IACA,IAAI,CAACd,gBAAgB,IAAI,CAACa,iBAAiB,IAAI,CAACC,SAAS,EAAE;MACzD,MAAM,IAAItC,QAAA,CAAA0B,sBAAsB,CAC9B,sEAAsE,CACvE;;IAGH,OAAO5B,IAAI,CAACyC,MAAM,CAACF,iBAAiB,EAAEb,gBAAgB,EAAEc,SAAS,EAAE;MAAEE,MAAM,EAAE;IAAK,CAAE,CAAC;EACvF;;AAjDFC,OAAA,CAAA3B,eAAA,GAAAA,eAAA;AACSA,eAAA,CAAA4B,aAAa,GAAG,QAAQ"},"metadata":{},"sourceType":"script","externalDependencies":[]}