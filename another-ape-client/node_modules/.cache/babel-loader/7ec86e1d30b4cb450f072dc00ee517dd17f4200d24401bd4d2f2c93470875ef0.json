{"ast":null,"code":"import { sha256 } from '@noble/hashes/sha256';\nimport { sha512 } from '@noble/hashes/sha512';\nimport { getCryptoLib } from './cryptoUtils';\nexport class NodeCryptoSha2Hash {\n  constructor(createHash) {\n    this.createHash = createHash;\n  }\n  async digest(data, algorithm = 'sha256') {\n    try {\n      const result = this.createHash(algorithm).update(data).digest();\n      return Promise.resolve(result);\n    } catch (error) {\n      console.log(error);\n      console.log(`Error performing ${algorithm} digest with Node.js 'crypto.createHash', falling back to JS implementation.`);\n      return Promise.resolve(algorithm === 'sha256' ? hashSha256Sync(data) : hashSha512Sync(data));\n    }\n  }\n}\nexport class WebCryptoSha2Hash {\n  constructor(subtleCrypto) {\n    this.subtleCrypto = subtleCrypto;\n  }\n  async digest(data, algorithm = 'sha256') {\n    let algo;\n    if (algorithm === 'sha256') {\n      algo = 'SHA-256';\n    } else if (algorithm === 'sha512') {\n      algo = 'SHA-512';\n    } else {\n      throw new Error(`Unsupported hash algorithm ${algorithm}`);\n    }\n    try {\n      const hash = await this.subtleCrypto.digest(algo, data);\n      return new Uint8Array(hash);\n    } catch (error) {\n      console.log(error);\n      console.log(`Error performing ${algorithm} digest with WebCrypto, falling back to JS implementation.`);\n      return Promise.resolve(algorithm === 'sha256' ? hashSha256Sync(data) : hashSha512Sync(data));\n    }\n  }\n}\nexport async function createSha2Hash() {\n  const cryptoLib = await getCryptoLib();\n  if (cryptoLib.name === 'subtleCrypto') {\n    return new WebCryptoSha2Hash(cryptoLib.lib);\n  } else {\n    return new NodeCryptoSha2Hash(cryptoLib.lib.createHash);\n  }\n}\nexport function hashSha256Sync(data) {\n  return sha256(data);\n}\nexport function hashSha512Sync(data) {\n  return sha512(data);\n}","map":{"version":3,"names":["sha256","sha512","getCryptoLib","NodeCryptoSha2Hash","constructor","createHash","digest","data","algorithm","result","update","Promise","resolve","error","console","log","hashSha256Sync","hashSha512Sync","WebCryptoSha2Hash","subtleCrypto","algo","Error","hash","Uint8Array","createSha2Hash","cryptoLib","name","lib"],"sources":["/home/ryanosull/clarity/clarity-camp/projects/nft-vids/another-ape-client/node_modules/@stacks/encryption/src/sha2Hash.ts"],"sourcesContent":["import { sha256 } from '@noble/hashes/sha256';\nimport { sha512 } from '@noble/hashes/sha512';\nimport { getCryptoLib } from './cryptoUtils';\n\ntype NodeCryptoCreateHash = typeof import('crypto').createHash;\n\nexport interface Sha2Hash {\n  digest(data: Uint8Array, algorithm?: 'sha256' | 'sha512'): Promise<Uint8Array>;\n}\n\nexport class NodeCryptoSha2Hash {\n  createHash: NodeCryptoCreateHash;\n\n  constructor(createHash: NodeCryptoCreateHash) {\n    this.createHash = createHash;\n  }\n\n  async digest(data: Uint8Array, algorithm = 'sha256'): Promise<Uint8Array> {\n    try {\n      const result = this.createHash(algorithm).update(data).digest();\n      return Promise.resolve(result);\n    } catch (error) {\n      console.log(error);\n      console.log(\n        `Error performing ${algorithm} digest with Node.js 'crypto.createHash', falling back to JS implementation.`\n      );\n      return Promise.resolve(algorithm === 'sha256' ? hashSha256Sync(data) : hashSha512Sync(data));\n    }\n  }\n}\n\nexport class WebCryptoSha2Hash implements Sha2Hash {\n  subtleCrypto: SubtleCrypto;\n\n  constructor(subtleCrypto: SubtleCrypto) {\n    this.subtleCrypto = subtleCrypto;\n  }\n\n  async digest(data: Uint8Array, algorithm = 'sha256'): Promise<Uint8Array> {\n    let algo: string;\n    if (algorithm === 'sha256') {\n      algo = 'SHA-256';\n    } else if (algorithm === 'sha512') {\n      algo = 'SHA-512';\n    } else {\n      throw new Error(`Unsupported hash algorithm ${algorithm}`);\n    }\n    try {\n      const hash = await this.subtleCrypto.digest(algo, data);\n      return new Uint8Array(hash);\n    } catch (error) {\n      console.log(error);\n      console.log(\n        `Error performing ${algorithm} digest with WebCrypto, falling back to JS implementation.`\n      );\n      return Promise.resolve(algorithm === 'sha256' ? hashSha256Sync(data) : hashSha512Sync(data));\n    }\n  }\n}\n\nexport async function createSha2Hash(): Promise<Sha2Hash> {\n  const cryptoLib = await getCryptoLib();\n  if (cryptoLib.name === 'subtleCrypto') {\n    return new WebCryptoSha2Hash(cryptoLib.lib);\n  } else {\n    return new NodeCryptoSha2Hash(cryptoLib.lib.createHash);\n  }\n}\n\nexport function hashSha256Sync(data: Uint8Array) {\n  return sha256(data);\n}\n\nexport function hashSha512Sync(data: Uint8Array) {\n  return sha512(data);\n}\n"],"mappings":"AAAA,SAASA,MAAM,QAAQ,sBAAsB;AAC7C,SAASC,MAAM,QAAQ,sBAAsB;AAC7C,SAASC,YAAY,QAAQ,eAAe;AAQ5C,OAAM,MAAOC,kBAAkB;EAG7BC,YAAYC,UAAgC;IAC1C,IAAI,CAACA,UAAU,GAAGA,UAAU;EAC9B;EAEA,MAAMC,MAAMA,CAACC,IAAgB,EAAEC,SAAS,GAAG,QAAQ;IACjD,IAAI;MACF,MAAMC,MAAM,GAAG,IAAI,CAACJ,UAAU,CAACG,SAAS,CAAC,CAACE,MAAM,CAACH,IAAI,CAAC,CAACD,MAAM,EAAE;MAC/D,OAAOK,OAAO,CAACC,OAAO,CAACH,MAAM,CAAC;KAC/B,CAAC,OAAOI,KAAK,EAAE;MACdC,OAAO,CAACC,GAAG,CAACF,KAAK,CAAC;MAClBC,OAAO,CAACC,GAAG,CACT,oBAAoBP,SAAS,8EAA8E,CAC5G;MACD,OAAOG,OAAO,CAACC,OAAO,CAACJ,SAAS,KAAK,QAAQ,GAAGQ,cAAc,CAACT,IAAI,CAAC,GAAGU,cAAc,CAACV,IAAI,CAAC,CAAC;;EAEhG;;AAGF,OAAM,MAAOW,iBAAiB;EAG5Bd,YAAYe,YAA0B;IACpC,IAAI,CAACA,YAAY,GAAGA,YAAY;EAClC;EAEA,MAAMb,MAAMA,CAACC,IAAgB,EAAEC,SAAS,GAAG,QAAQ;IACjD,IAAIY,IAAY;IAChB,IAAIZ,SAAS,KAAK,QAAQ,EAAE;MAC1BY,IAAI,GAAG,SAAS;KACjB,MAAM,IAAIZ,SAAS,KAAK,QAAQ,EAAE;MACjCY,IAAI,GAAG,SAAS;KACjB,MAAM;MACL,MAAM,IAAIC,KAAK,CAAC,8BAA8Bb,SAAS,EAAE,CAAC;;IAE5D,IAAI;MACF,MAAMc,IAAI,GAAG,MAAM,IAAI,CAACH,YAAY,CAACb,MAAM,CAACc,IAAI,EAAEb,IAAI,CAAC;MACvD,OAAO,IAAIgB,UAAU,CAACD,IAAI,CAAC;KAC5B,CAAC,OAAOT,KAAK,EAAE;MACdC,OAAO,CAACC,GAAG,CAACF,KAAK,CAAC;MAClBC,OAAO,CAACC,GAAG,CACT,oBAAoBP,SAAS,4DAA4D,CAC1F;MACD,OAAOG,OAAO,CAACC,OAAO,CAACJ,SAAS,KAAK,QAAQ,GAAGQ,cAAc,CAACT,IAAI,CAAC,GAAGU,cAAc,CAACV,IAAI,CAAC,CAAC;;EAEhG;;AAGF,OAAO,eAAeiB,cAAcA,CAAA;EAClC,MAAMC,SAAS,GAAG,MAAMvB,YAAY,EAAE;EACtC,IAAIuB,SAAS,CAACC,IAAI,KAAK,cAAc,EAAE;IACrC,OAAO,IAAIR,iBAAiB,CAACO,SAAS,CAACE,GAAG,CAAC;GAC5C,MAAM;IACL,OAAO,IAAIxB,kBAAkB,CAACsB,SAAS,CAACE,GAAG,CAACtB,UAAU,CAAC;;AAE3D;AAEA,OAAM,SAAUW,cAAcA,CAACT,IAAgB;EAC7C,OAAOP,MAAM,CAACO,IAAI,CAAC;AACrB;AAEA,OAAM,SAAUU,cAAcA,CAACV,IAAgB;EAC7C,OAAON,MAAM,CAACM,IAAI,CAAC;AACrB"},"metadata":{},"sourceType":"module","externalDependencies":[]}